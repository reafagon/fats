#<center>前端自动化构建方案</center>
<br>

##1、方案意义##

面对大型的网站开发，前端也会涉及到多人开发，而多人并行开发的条件是公共组件与业务模块化，一般的做法是，大家一起讨论，抽象出一些组件和业务模块，定义好相应接口，再分配不同的人来开发，开发的时候同在一个svn 和写相应的静态html测试开发效果。完全Ok了则提给后端开发做相应模板。

可能大家在开发过程中彼此协作问题不大, 但临近着测试与上线，问题就出来了，每个页面都有一大堆js和css ,上线后肯定不允许这样，那怎么可以方便的合并，之前的js,css都没有经过yui压缩，之前调用后端接口都是测试地址，但上线后肯定需要换成正式地址，怎么换比较方便。

其实以上问题就是开发人员的方便开发与用户的体验之间的矛盾，我们需要想办法平衡这种矛盾，即怎么样可以让开发人员在开发时能模块式开发，不用去关注合并，压缩，图片压缩，图片合并这些重复劳动，并且让用户又可以有好的速度体验。

##2、方案试概述##

线下与线上之间我们需要一个编译系统来做这个事情，即它需要完成以下需求。

1. 自动按照某种规则合并当前页面的js和css ,让原来无数个请求变成较少请求。
2. 能自动替换一些地址。比如后端的接口地址，图片的地址等等。
3. 能自动压缩js ,css (如通过yui).
4. 能压缩一些静态图片(比如png图片）
5. 能按照某种规则来css-sprite
可能还有其他的一些类似上面的需求，自动化编译环境相当于是一个工具集，来代替手动完成的事情。

而我们现在需要这么一个环境来让开发人员只用专注开发，将他们从合并，压缩等一些繁琐的劳动中解放出来。




现有：  
手动 sass/less进行编译  
手动 jshint 代码质量测试  
手动 合并资源文件  
手动 修改资源文件的引用路径  
手动 文件压缩  

<font style="color:#c00;font-weight:700;">
优点：  
1、优化代码，合并请求，压缩文件，提升页面性能  
2、由人工操作转向为工具自动化，符合前端发展的趋势  
3、简化工作流程，一劳永逸的实现前端的自动化构建  
4、配置文件灵活，可以用第三方插件，可以自行扩展  
5、独立的前端环境，可以自行完成代码测试  

缺点：  
1、依赖NodeJS环境，在我司暂时不被支持（NodeJS是前端的未来趋势，现在所有的或是新技术或是前端解决方案，都离不开NodeJS。）  
2、需要手动在命令行下运行  
</font>

所以构建一个自动化的前端开发流程是非常必要的。



现在的前端开发流程如下：  
1、创建文件夹,命名为新项目balbala  
2、新建一个index.html，从过去的一个文件中把用得到的html代码拷贝进来，再新建css、js、images文件夹  
3、新建style.css,base.js等需要的样式表文件和js以及一堆乱七八糟的文件。  
4、切图、写html，写css、写js  
5、不断F5刷新、F5刷新：浏览器里测试  
6、差不多完成了，用一个压缩工具（线下的或者在线的），压缩下js和css文件，新建一个min.style.css和min.v.js，修改html中的文件路径，填充，搞掂。  
7、提交svn。  


　　而现代的开发流程，就是要使上面的各个部分都可以自动化，一个命令就可以使这些流程都自动走完，并且快速的得到错误或通过的反馈，让我们可以方便快速的修复错误和release。


本地开发环境的初始化

　　这里我使用的工具是Node.js、NPM和grunt，它们都基于JavaScript，使用Json来配置，对于前端开发人员非常友好。


##3、使用范围及用户

前端自动化工具系统

使用范围：在苏宁易购整个前端内部，都适用，通过Node.js、NPM和grunt来实现前端开发的自动化构建。
用户：苏宁易购前端开发、开发内部都适用。


需求描述及期望效果：
使用前端自动化系统，通过几个命令，远程拉去仓库原始包文件，自动对资源文件合并和压缩，提升整体页面性能。修改文件时实现自动刷新页面功能，减少在开发过程中不断切换浏览器手动测试，快速的得到错误或通过的反馈，让我们可以方便快速的修复错误和release。优化前端开发工作环境，实现前端开发的自动化构建系统。


##4、详细计划：（立项）
####1、初始化模板定制（自动化命名，模板初始化）+ 初始化命令构建工程 + 自动刷新预览
（9月份完成） 
### 功能发布：
####2、文件关系管理+合并压缩方案管理  
####3、代码开发解决的自动化时间戳+自动化监控文件记录
### web服务：
####4、自动刷新
（10月份完成）
####5、每个阶段文档+使用手册+推广使用  
（10月份同步完成、11月初开始进行培训、分享）



##5、项目文档##
Grunt是一个自动化的项目构建工具。如果你需要重复的执行像压缩，编译，单元测试，代码检查以及打包发布的任务。那么你可以使用Grunt来处理这些任务，你所需要做的只是配置好Grunt，这样能很大程度的简化你的工作。

安装grunt-init  
这个不是必须的，但是有了grunt-init，可以自动为你初始化项目，很方便，而且对于jquery插件有现成的初始化模版。
npm install -g grunt-init

这样就在全局安装了grunt-init，有了初始化工具，还需要模版，不然不知道该按哪种项目类型来初始化。

grunt官网提供了很多模版，将模版目录copy到~/.grunt-init/目录下即可使用
git clone https://github.com/gruntjs/grunt-init-jquery.git ~/.grunt-init/jquery
这样有了jquery插件的初始化模版

有了模版，使用一行命令来初始化
grunt-init jquery
模版会自动创建好package.json和Gruntfile.js

<br/>
<br/>
<br/>
